{% extends 'base.html' %}

{% block head %}

<title>Speech to subtitle</title>

{% endblock %}

{% block body %}
    <h1>Real-time Speech Transcription</h1>
    <button id="recordButton">Start Recording</button>
    <button id="stopButton" disabled>Stop Recording</button>
    <div id="transcription"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.1.3/socket.io.min.js"></script>
    <script>
        const socket = io();

        document.getElementById('recordButton').addEventListener('click', () => {
            socket.emit('start');
            document.getElementById('recordButton').disabled = true;
            document.getElementById('stopButton').disabled = false;

            navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
                const mediaRecorder = new MediaRecorder(stream);
                mediaRecorder.start();

                mediaRecorder.addEventListener('dataavailable', event => {
                    socket.emit('audio_data', event.data);
                });

                document.getElementById('stopButton').addEventListener('click', () => {
                    mediaRecorder.stop();
                    socket.emit('stop');
                    document.getElementById('recordButton').disabled = false;
                    document.getElementById('stopButton').disabled = true;
                });
            });
        });

        socket.on('status', (data) => {
            console.log(data.status);
        });

        socket.on('transcription', (data) => {
            const transcriptionDiv = document.getElementById('transcription');
            transcriptionDiv.innerText += '\n' + data.transcription;
        });
    </script>


{% endblock %}
